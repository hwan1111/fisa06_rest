# fisa06_rest

# 🍴 우리 반 맛집 실록 

> 부트캠프 동료들과 함께하는 맛집 공유 플랫폼

본 프로젝트는 부트캠프 동료들 간의 맛집 정보와 리뷰를 공유할 수 있는 플랫폼으로, 기존의 단편적인 맛집 등록 시스템을 넘어 **관계형 데이터베이스(RDBMS)**를 활용한 데이터 무결성 확보와 **메뉴 중심의 사용자 경험**을 제공하기 위해 설계된 Streamlit 기반 웹 애플리케이션입니다.

---

## 📋 목차

- [프로젝트 개요](#-프로젝트-개요)
- [주요 기능](#-주요-기능)
- [기술 스택](#-기술-스택)
- [시스템 아키텍처](#-시스템-아키텍처)
- [데이터베이스 설계](#-데이터베이스-설계)
- [설치 및 실행](#-설치-및-실행)
- [팀원 소개](#-팀원-소개)
- [트러블슈팅](#-트러블슈팅)

---

## 🎯 프로젝트 개요

### 프로젝트 목표

- 부트캠프 동료들 간에 **맛집 정보와 리뷰를 공유**할 수 있는 플랫폼 구축
- **맛집 미슐랭 가이드**로서 동료들이 서로 가본 맛집의 위치와 리뷰를 등록하여 경험을 공유
- 학급/팀원 간의 신뢰도 높은 맛집 데이터 공유 및 메뉴별 상세 리뷰 아카이빙

### 기획 배경

- **맛집 추천과 후기**는 매우 유익하지만, 다양한 장소에 흩어져 있는 정보들을 **체계적으로 모은다면** 더 큰 가치를 제공할 수 있음
- **서로의 경험을 실시간으로 공유**하고, 이를 **지도로 확인**할 수 있는 서비스 제공
- 부트캠프에서 배운 **데이터 처리 및 시각화 기술**을 실제로 활용하는 좋은 기회

### 주요 변경 사항

- ✅ 데이터 저장소 전환 (Google Sheets → MySQL)
- ✅ 리뷰 단위 고도화 (식당 중심 → 메뉴 아이템 중심)
- ✅ 사용자 인증 시스템 도입 (회원가입 및 로그인)

---

## ✨ 주요 기능

### 1. 로그인 및 회원가입
- 사용자 ID와 비밀번호를 이용한 로그인 시스템
- 세션 기반 사용자 인증 및 개인화 서비스

### 2. 메뉴 중심 맛집 등록
- 특정 식당의 특정 메뉴에 대한 상세 평가 기록
- 자동 주소 → 위경도 변환 (Geopy)
- 맛집 이름, 주소, 카테고리, 메뉴명, 별점, 후기, URL 등 입력

### 3. 통합 식당 카드 UI
- 동일 식당의 모든 리뷰를 하나의 카드로 그룹화
- 실시간 평균 별점 계산 및 표시
- 최신순 리뷰 정렬

### 4. 팀원 모집 기능
- 맛집 방문 팀원 모집 게시판
- 다른 사용자와 함께 맛집 방문 가능
- 실시간 팀원 목록 관리

### 5. 데이터 시각화
- **지도 시각화**: Folium 기반 맛집 위치 마커 표시
- **카테고리별 필터링**: 원하는 카테고리의 맛집만 선택적으로 확인
- **트렌드 분석**: Plotly를 활용한 일자별/맛집별 평점 추이 그래프
- **통계 차트**: 카테고리별 평균 별점 시각화

---

## 🛠 기술 스택

### Libraries
- **Streamlit**: 웹 애플리케이션의 인터페이스 구성
- **Pandas**: 데이터 분석 및 가공
- **MySQL**: 데이터 저장 및 관리
- **Folium**: 지리적 데이터 시각화
- **Plotly**: 인터랙티브 차트 시각화
- **Geopy**: 주소를 위도, 경도로 변환

---

## 🏗 시스템 아키텍처

본 시스템은 파이썬 라이브러리와 관계형 데이터베이스의 유기적인 결합을 통해 데이터의 생성, 조회, 시각화를 처리합니다.

```
┌─────────────────────────────────────────┐
│     프레젠테이션 계층 (Frontend)          │
│           Streamlit UI                   │
└─────────────┬───────────────────────────┘
              │
┌─────────────▼───────────────────────────┐
│  애플리케이션 로직 계층 (Backend Logic)   │
│       data_handler.py                    │
│    CRUD 연산 + 비즈니스 로직             │
└─────────────┬───────────────────────────┘
              │
┌─────────────▼───────────────────────────┐
│       데이터 계층 (Database)             │
│     MySQL (정규화된 테이블 구조)         │
└─────────────────────────────────────────┘
              │
┌─────────────▼───────────────────────────┐
│         GIS (지리정보 시스템)            │
│    Geopy (주소→위경도) + Folium (지도)   │
└─────────────────────────────────────────┘
```

### 계층별 역할

- **프레젠테이션 계층**: 웹 페이지 상의 데이터 입력, 시각화된 지도 및 차트 표시
- **애플리케이션 로직 계층**: 데이터 처리, 데이터베이스 연동, 분석 및 시각화 작업 수행
- **데이터 계층**: 1:N:M 관계의 정규화된 데이터 모델링, 데이터 안전 저장 및 관리
- **GIS 계층**: 주소 기반 위경도 추출 및 지도 시각화

---

## 💾 데이터베이스 설계

데이터의 일관성을 위해 6개의 테이블이 상호 외래키(Foreign Key)로 연결되어 있으며, 특히 `MENU_REVIEWS`를 중심으로 상세 평가 데이터를 관리합니다.

### ERD (Entity Relationship Diagram)

<img src='https://github.com/hwan1111/fisa06_rest/blob/main/ERD.png' width="50%" height="30%">

### 주요 테이블

| 테이블명 | 설명 | 주요 컬럼 |
|---------|------|----------|
| USERS | 사용자 정보 | user_id, username, password |
| RESTAURANTS | 맛집 정보 | restaurant_id, name, address, latitude, longitude, category |
| MENU_ITEMS | 메뉴 아이템 | menu_id, restaurant_id, menu_name |
| MENU_REVIEWS | 메뉴별 리뷰 | review_id, menu_id, user_id, rating, comment |
| PARTIES | 팀원 모집 정보 | party_id, restaurant_id, host_id |
| PARTY_PARTICIPANTS | 파티 참여자 | participant_id, party_id, user_id |

---

## 🐍 Python 파일 기능 설명

프로젝트는 Streamlit 기반 UI(프론트) + MySQL(백엔드 데이터) + OpenAI/Open‑Meteo(외부 API)로 구성되어 있습니다.  
아래는 주요 `.py` 파일별 역할과 핵심 함수(또는 동작) 요약입니다.

### 1) `AI 맛집 추천.py` (Streamlit 메인 앱)
- **역할**: 서비스 화면(탭 UI) 렌더링 및 “예산별 추천/리뷰 분석” 전체 플로우를 담당합니다.
- **주요 화면**
  - **탭1: 예산별 맞춤 추천**
    - 주소 입력 → (Geopy) 위경도 변환 → (Open‑Meteo) 날씨 조회
    - 예산 이하 메뉴를 DB에서 조회 후 **TOP 5**만 추려서 AI 추천 문구 생성
    - TOP 5 가격 비교 차트(Plotly) + 상세 테이블 표시
  - **탭2: 리뷰 심층 분석**
    - 식당 선택 → 해당 식당의 메뉴/리뷰를 **JOIN 쿼리**로 가져와 텍스트 결합
    - OpenAI로 5개 항목(맛/가성비/서비스/위생/분위기) 점수 + 한줄평 생성
    - 레이더 차트 + 워드클라우드로 시각화
- **DB 연동 포인트**
  - `st.connection("mysql", type="sql")` 기반으로 SQL을 실행합니다.
  - 리뷰 분석은 다음 관계를 사용합니다:
    - `menu_reviews.menu_item_id` → `menu_items.id`
    - `menu_items.restaurant_id` → `restaurants.id`
- **성능 최적화**
  - `@st.cache_data`로 **주소 지오코딩/날씨 조회/DB 조회**를 캐싱하여 불필요한 재호출을 줄입니다.
  - `st.session_state`로 탭별 분석 결과를 유지해 리렌더링 시 UX가 깨지지 않게 했습니다.

### 2) `recommend.py` (AI/날씨 로직 모듈)
- **역할**: 외부 API를 호출하여 “날씨 정보”와 “AI 결과”를 만들어 메인 앱에서 재사용하도록 분리한 모듈입니다.
- **주요 함수**
  - `get_weather(lat, lon)`  
    - Open‑Meteo를 호출해 현재 날씨/기온을 가져옵니다.
  - `get_ai_recommendation(weather_info, candidates, user_budget)`  
    - 후보 메뉴 리스트(메뉴명/식당명/카테고리/가격) + 예산 + 날씨를 입력으로,
      **예산 근접도**와 **날씨 연관성**을 반영한 추천 멘트를 생성합니다.
  - `get_review_analysis(rest_name, reviews_text)`  
    - 리뷰 텍스트를 기반으로 5개 항목 점수와 한줄평을 **JSON 형태**로 반환합니다.

### 3) (선택) `data_handler.py`, `login.py` 등 보조 모듈
> 레포에 포함된 경우에만 사용됩니다. (팀 버전에 따라 파일/역할이 다를 수 있어요.)

- `data_handler.py`: DB CRUD(조회/삽입/수정/삭제) 헬퍼 및 비즈니스 로직 모음 (프로젝트 호환을 위해 import 유지)
- `login.py`: 로그인/회원가입 등 사용자 인증 흐름을 분리한 모듈
- `utils.py`: 주소→좌표 변환 등 공통 유틸 함수

---

### 🧩 “리뷰가 0개로 나오는 경우” 체크리스트
- `menu_reviews.menu_item_id` 값이 실제 `menu_items.id`와 일치하는지
- `menu_items.restaurant_id` 값이 선택한 `restaurants.id`와 일치하는지
- 아래 쿼리로 식당별 리뷰 수가 0인지 확인:
  - `SELECT COUNT(*) FROM menu_items WHERE restaurant_id = <rest_id>;`
  - `SELECT COUNT(*) FROM menu_reviews rv JOIN menu_items m ON rv.menu_item_id=m.id WHERE m.restaurant_id=<rest_id>;`

## 👥 팀원 소개

| 이름 | 역할 | 주요 기여 |
|------|------|----------|
| 김동환 | 팀장 / Full-stack | 전체적인 아이디어 기초 프레임 개발 및 Streamlit 애플리케이션 구현 |
| 김유정 | Backend / Data | MySQL 데이터베이스 연동 및 데이터 분석, 가격 데이터 시각화 |
| 권민석 | Frontend / DevOps | 로그인 기능 개발, Folium을 이용한 지도 깜빡임 문제 해결 |
| 이주형 | Database / Data | 데이터베이스 구축 및 데이터 정제 |

---

## 🔧 트러블슈팅

### 문제 1: MySQL 데이터베이스 연결 오류

**증상**
```
MySQL Connection Error: Access denied for user
```

**원인**: 데이터베이스 자격 증명 정보 오류

**해결방법**: 
- `.env` 파일 및 `secrets.toml` 파일의 데이터베이스 자격 증명 확인 및 수정
- MySQL 사용자 권한 확인: `GRANT ALL PRIVILEGES ON database_name.* TO 'username'@'host';`

---

### 문제 2: 주소 데이터 오류로 인한 지도 표시 오류

**증상**
```
Geocoding Error: Address not found
```

**원인**: 부정확한 주소로 인한 위경도 변환 실패

**해결방법**: 
- **Geopy**의 `Nominatim` geocoder를 사용하여 주소 검증 로직 추가
- 주소 입력 시 상세 주소 가이드라인 제공
- 변환 실패 시 사용자에게 알림 및 재입력 유도

---

### 문제 3: Folium 지도 깜빡임 현상

**증상**: Streamlit 리렌더링 시 지도가 계속 깜빡이는 현상

**원인**: Streamlit의 리렌더링으로 인한 지도 재생성

**해결방법**: 
- `st.session_state`를 활용한 지도 상태 관리
- 지도 객체를 세션에 캐싱하여 불필요한 재생성 방지
```python
if 'map' not in st.session_state:
    st.session_state.map = create_map()
```

---

## 🎓 기술적 성과

### 보안성 강화
- `secrets.toml`을 활용하여 DB 접속 정보를 소스 코드와 분리
- 배포 시 보안 유출 방지를 위한 환경 변수 관리

### 성능 최적화
- SQL JOIN을 활용하여 여러 테이블에 흩어진 데이터를 단일 쿼리로 조회
- 네트워크 부하 감소 및 응답 속도 향상

### 사용자 편의성
- 자동 위경도 변환 로직을 통해 사용자가 좌표를 몰라도 주소만으로 지도 생성 가능
- 직관적인 UI/UX 설계로 진입 장벽 최소화

### 데이터 무결성
- 관계형 데이터베이스의 외래키 제약 조건을 통한 데이터 일관성 보장
- 트랜잭션 처리로 데이터 정합성 유지

---

## 📊 프로젝트 성과

### 주요 성과

- ✅ Google Sheets에서 MySQL로의 전환을 통한 데이터 관리 고도화
- ✅ 메뉴 중심의 리뷰 시스템으로 상세한 맛집 정보 제공
- ✅ 사용자 인증 시스템을 통한 개인화된 서비스 구현
- ✅ 팀원 모집 기능을 통한 커뮤니티 활성화
- ✅ 지도 및 차트를 활용한 직관적인 데이터 시각화

### 학습 효과

부트캠프에서 배운 데이터 처리 및 시각화 기술을 실제로 활용하여, 데이터를 수집, 분석, 시각화하고 사용자에게 가치를 제공하는 방법을 배울 수 있는 좋은 기회가 되었습니다.

---

## 📝 라이선스

This project is licensed under the MIT License.

---

## 📧 문의

프로젝트에 대한 문의사항이 있으시면 이슈를 등록해주세요.

**Developed with ❤️ by Team Restaurant Guide**

