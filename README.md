```markdown
# fisa06_미니 프로젝트 - 로그인 기능 중심 브랜치

## 1. 프로젝트 개요

이 브랜치는 **로그인 기능**을 중심으로 작성되었습니다. **Streamlit**을 사용하여 **사용자 인증** 및 **세션 관리**를 구현하였으며, 로그인 후 사용자 정보를 **세션 상태**(`st.session_state`)로 관리하여 **다른 페이지**나 **컴포넌트**에서도 사용자 정보를 활용할 수 있도록 했습니다.

## 2. 프로젝트 구조

이 프로젝트는 **로그인 기능**을 중심으로 구성되어 있으며, 관련 파일들은 **`login`** 폴더 내에 모여 있습니다. 각 파일은 다음과 같습니다:

```
├── Login.py # 내가 추가한 로그인 페이지
├── components.py # 원래 기본 컴포넌트 파일
├── data_handler.py # 원래 기본 데이터 처리 파일
├── login
│   ├── auth.py # 내가 추가한 로그인 관련 인증 처리 코드
│   ├── login_config.py # 내가 추가한 로그인 관련 설정 파일
│   └── login_data_handle.py # 내가 추가한 로그인 데이터 처리 파일
├── pages # Login.py를 메인으로 쓰기위해 페이지로 분리
│   └── 미슐랭 서비스.py # 원래 기본 미슐랭 서비스 페이지
├── requirements.txt # 프로젝트 의존성 패키지 목록
└── utils.py # 원래 기본 유틸리티 함수 파일
```

### 각 파일의 역할:

1. **`Login.py`**:
   - **로그인 페이지**로, 사용자 아이디와 이메일을 입력받아 로그인 처리를 합니다.

2. **`login/auth.py`**:
   - **로그인 인증**을 처리하는 코드입니다. 사용자의 아이디와 이메일을 확인하고 세션에 저장합니다.

3. **`login/login_config.py`**:
   - 로그인 관련 설정 파일입니다. 데이터베이스 연결 설정이나 로그인 동작에 필요한 기본 설정들이 들어갑니다.

4. **`login/login_data_handle.py`**:
   - 데이터베이스와 상호작용하는 코드로, 사용자의 정보를 조회하거나 삽입하는 기능을 제공합니다.

5. **`components.py`**:
   - **Streamlit** 애플리케이션에 필요한 **UI 컴포넌트**들을 처리하는 기본 파일입니다.

6. **`data_handler.py`**:
   - 데이터베이스에서 데이터를 가져오거나 저장하는 기본 함수들이 포함된 파일입니다.

7. **`미슐랭 서비스.py`**:
   - 원래의 **미슐랭 서비스** 페이지로, 로그인된 사용자에게 **맛집 서비스**를 제공하는 페이지입니다.

## 3. 로그인 기능 구현

### 로그인 페이지

- 로그인 페이지에서 사용자는 **아이디**와 **이메일**을 입력하여 로그인합니다.
- 로그인 후 사용자의 **아이디**와 **이메일**은 **`st.session_state`**에 저장되며, 다른 페이지나 컴포넌트에서도 **로그인 상태**와 **사용자 정보**를 활용할 수 있습니다.

#### 로그인 함수 (`login/auth.py`)

```python
def login_user(user_id, email):
    """
    사용자 로그인 함수
    - 입력된 아이디와 이메일을 비교하여 로그인 처리
    """
    query = "SELECT name FROM users WHERE id = %s AND email = %s;"
    params = (user_id, email)
    result = fetch_query(query, params)

    if result:
        stored_name = result[0][0]  # 저장된 사용자 이름
        # 로그인 세션 관리
        st.session_state.user_id = user_id  # 사용자 아이디 저장
        st.session_state.email = email  # 사용자 이메일 저장
        st.session_state.logged_in = True  # 로그인 상태 저장
        st.session_state.user_name = stored_name  # 사용자 이름 세션에 저장
        st.success(f"로그인 성공! 환영합니다, {stored_name}님.")  # 사용자 이름 표시
    else:
        st.error("존재하지 않는 사용자이거나 이메일이 잘못되었습니다.")
```

로그인 처리 과정:

사용자가 아이디와 이메일을 입력하고 로그인 버튼을 클릭하면,

`login_user` 함수가 호출되어 아이디와 이메일을 데이터베이스에서 조회합니다.

사용자가 존재하는 경우에는 로그인 상태를 **`st.session_state`**에 저장하고, 환영 메시지를 출력합니다.

사용자가 존재하지 않거나 이메일이 잘못된 경우에는 에러 메시지가 출력됩니다.

로그인 후 세션 상태 관리

로그인 시, 사용자의 아이디와 이메일을 세션 상태(`st.session_state`)에 저장하여 로그인 상태를 유지합니다. 이를 통해 다른 페이지나 컴포넌트에서 사용자 정보를 계속해서 활용할 수 있습니다.

```python
# 로그인 후 세션 상태에 아이디 저장
st.session_state.user_id = user_id  # 예시로 입력된 user_id 저장
st.session_state.logged_in = True  # 로그인 상태 저장
```

다른 페이지에서 로그인 정보 사용하기

다른 페이지에서 사용자가 로그인한 정보를 세션 상태에서 가져와서 사용할 수 있습니다.

```python
if 'logged_in' in st.session_state and st.session_state.logged_in:
    user_id = st.session_state['user_id']  # 세션 상태에서 user_id 가져오기
    st.write(f"현재 로그인한 사용자: {user_id}")
else:
    st.write("로그인되지 않았습니다.")
```

## 4. 세션 상태 설명

**`st.session_state`**는 세션 동안 전역 상태를 관리하는 객체로, 로그인 정보, 사용자 아이디, 이메일 등을 저장하고, 다른 페이지나 컴포넌트에서 계속 사용할 수 있게 해줍니다.

세션 상태 사용 예시:

**`st.session_state`**에 로그인 정보를 저장하고, 이를 다른 페이지에서 불러와서 사용할 수 있습니다.

**`st.session_state['user_id']`**와 같은 방식으로 로그인한 아이디나 이메일을 가져올 수 있습니다.

## 5. 트러블슈팅

로그인 후 페이지 이동 및 사용자 정보 넘기기 문제

원래 개발 경험 (Dart 및 프론트엔드 개발):

저는 주로 Dart와 같은 프론트엔드 언어를 사용하여 개발을 해왔습니다. 일반적으로 프론트엔드 언어를 사용할 때는, 로그인 페이지에서 다른 페이지로 바로 이동하거나, URL 파라미터나 폼 데이터 등을 사용하여 사용자 정보를 넘겨주는 방식으로 페이지 간의 데이터를 주고받을 수 있었습니다.

Streamlit에서 겪은 문제:

그러나 Streamlit을 사용하면서 로그인 페이지에서 다른 페이지로 넘어가려고 했을 때, 다음과 같은 문제를 겪었습니다:

페이지 간 이동: Streamlit에서는 다른 페이지로 이동하는 방식이 아니라 **세션 상태 (st.session_state)**에 사용자 정보를 저장하여 다른 페이지에서 이를 활용하는 방식으로 동작합니다. 이 점이 기존 프론트엔드 개발 방식과 달라서 처음에는 많이 헷갈렸습니다.

세션 상태에 저장: Streamlit에서 사용자의 아이디나 이메일을 **세션 상태 (st.session_state)**에 저장하고, 다른 페이지에서 이 값을 가져오는 방식으로 처리해야 했습니다. URL 파라미터나 폼 데이터를 사용하는 대신, 세션 상태를 통해 서버 측에서 상태를 유지하는 방식이기 때문에, 프론트엔드 개발자 입장에서 적응이 필요했습니다.

내가 겪은 트러블슈팅:

로그인 페이지에서 다른 페이지로 이동할 때의 혼란:

Streamlit에서는 로그인 후, 다른 페이지로 자동으로 이동하는 기능을 제공하지 않습니다. 대신, **`st.session_state`**에 로그인 정보를 저장하고, 이후 다른 페이지에서 세션 상태를 참조하는 방식으로 작업을 해야 했습니다. 초기에는 이 방식이 기존 개발 방식과 달라서 혼란스러웠습니다.

사용자 정보 전달:

기존의 프론트엔드 방식에서는 URL 파라미터나 폼 데이터로 사용자의 아이디나 이메일을 다른 페이지로 넘겨줄 수 있었지만, Streamlit에서는 세션 상태를 사용하여 서버 측에서 사용자 정보를 유지해야 했습니다. 세션 상태에 값을 저장하고, 다른 페이지에서 이 값을 가져오는 방식에 대해 이해하고 적용하는 데 시간이 필요했습니다.

해결 방법:

세션 상태 (st.session_state) 사용:

Streamlit에서는 페이지 간에 사용자 정보를 넘기는 방식 대신, 세션 상태에 사용자 정보를 저장하고 다른 페이지에서 이 정보를 참조하는 방식으로 작업을 진행해야 합니다. 이를 통해 로그인 정보를 다른 페이지에서 유지하고 사용할 수 있었습니다.

```python
# 로그인 후 세션 상태에 정보 저장
st.session_state.user_id = user_id  # 예시로 입력된 user_id 저장
st.session_state.logged_in = True  # 로그인 상태 저장
```

다른 페이지에서 세션 값 사용:

다른 페이지에서는 **`st.session_state`**를 통해 로그인된 사용자의 아이디나 이메일을 쉽게 가져올 수 있습니다. 예를 들어:

```python
# 다른 페이지에서 세션 상태에서 사용자 정보 가져오기
if 'logged_in' in st.session_state and st.session_state.logged_in:
    user_id = st.session_state['user_id']
    st.write(f"현재 로그인한 사용자: {user_id}")
```
